{% load staticfiles %}
<!DOCTYPE html>
<html lang="zh">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="description" content="login">
    <meta name="author" content="lyw">
		<link href="{% static 'img/icon.png' %}" rel="icon">

		<title>课程点评网</title>

		<!-- Bootstrap core CSS -->
		<link href="{% static 'css/bootstrap.min.css' %}" type="text/css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="//oss.maxcdn.com/libs/html5shiv/3.6.2/html5shiv.js"></script>
    <script src="../../docs-assets/js/respond.min.js"></script>
    <![endif]-->
	</head>

	<body>
    <div class="container">

      <div class="page-header">
        <h1>课程点评网</h1>
        <p class="lead">让选课更欢乐</p>
      </div>
      {% csrf_token %}
      <form class="form-horizontal" role="form">
        <div class="form-group">
          <label for="username" class="col-sm-2 control-label">用户名/邮箱</label>
          <div class="col-sm-3 enter">
            <input type="text" class="form-control" id="username" placeholder="用户名/邮箱">
          </div>
          <div class="col-sm-2">
            <label for="username" id="un_prompt" class="text-danger control-label"></label>
          </div>
        </div>

        <div class="form-group">
          <label for="password" class="col-sm-2 control-label">密码</label>
          <div class="col-sm-3 enter">
            <input type="password" class="form-control" id="password" placeholder="密码">
          </div>
          <div class="col-sm-2">
            <label for="password" id="pw_prompt" class="text-danger control-label"></label>
          </div>
        </div>

        <div class="form-group">
          <div class="col-sm-offset-2 col-sm-3">
            <div class="checkbox">
              <label>
                <input type="checkbox" class="redir"> 记住我
                <a href="/register/" style="margin-left:80px">注册</a>
                <a href="/setpassword/" style="margin-left:10px">忘记密码？</a>
              </label>
            </div>
          </div>
        </div>

        <div class="form-group">
          <div class="col-sm-offset-4 col-sm-1">
            <button id="login" class="btn btn-primary" role="button">登录</button>
          </div>
        </div>
      </form>
    </div><!-- container -->
    
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="{% static 'js/jquery-1.10.2.min.js' %}"></script>
    <script src="{% static 'js/jquery-migrate-1.2.1.min.js' %}"></script>
    <script src="{% static 'js/bootstrap.min.js' %}"></script>
    <script src="{% static 'js/csrftoken.js' %}"></script>
    <!-- <script src="{% static 'js/myjquery.js' %}"></script> -->
    <script>
<<<<<<< HEAD
      $(document).ready(function(){
        $.csrftoken();
=======
      jQuery(document).ajaxSend(function(event, xhr, settings) {  
        function getCookie(name) {  
          var cookieValue = null;  
          if (document.cookie &&document.cookie != '') {  
            var cookies= document.cookie.split(';');  
            for (var i =0; i < cookies.length; i++) {  
              var cookie = jQuery.trim(cookies[i]);  
              // Does this cookie string begin with the name we want?  
              if (cookie.substring(0, name.length + 1) == (name + '=')) {  
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));  
                break;  
              }  
            }  
          }  
          return cookieValue;  
        }  
        function sameOrigin(url) {  
          // url could be relative or schemerelative or absolute  
          var host = document.location.host;// host + port  
          var protocol =document.location.protocol;  
          var sr_origin = '//' + host;  
          var origin = protocol + sr_origin;  
          // Allow absolute or scheme relativeURLs to same origin  
          return (url == origin ||url.slice(0, origin.length + 1) == origin + '/') ||  
            (url ==sr_origin || url.slice(0, sr_origin.length + 1) == sr_origin + '/') ||  
            // or anyother URL that isn't scheme relative or absolute i.e relative.  
            !(/^(\/\/|http:|https:).*/.test(url));  
        }  
        function safeMethod(method) {  
          return(/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));  
        }  
        if(!safeMethod(settings.type) && sameOrigin(settings.url)) {  
          xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));  
        }  
>>>>>>> 72e2ef2fff0287696a7b71335b05e75faf1a09a2
      });
      function login_post(){
        $.post("/login/",
        {
          username:$("#username").val(),
          password:$("#password").val()
        },
        function(data){
          if (data=='password'){
            $("#pw_prompt").html("密码错误！");
          }
          else
            if (data=='username'){
              $("#un_prompt").html("用户名不存在！");
            }
          else{
            document.write(data);
          }
        });
      }
      var last=0;
      $(".enter").keydown(function(e){
        if (e.keyCode==40||e.keyCode==38)
          last=1;
        else{
          if (e.keyCode==13)
          {
            e.preventDefault();
            if (last==0)
            {            
              e.preventDefault();
              login_post();
            }
          }
          last=0;
        }
      });
      $("#login").click(function(e){
        e.preventDefault();
        login_post();
      });
    </script>
	</body>
</html>